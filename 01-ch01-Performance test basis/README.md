
## 性能测试基础
### 定义
>性能测试是通过自动化的测试工具模拟多种正常、峰值以及异常负载条件来对系统的各项性能指标进行测试。负载测试和压力测试都属于性能测试，两者可以结合进行。通过负载测试，确定在各种工作负载下系统的性能，目标是测试当负载逐渐增加时，系统各项性能指标的变化情况。压力测试是通过确定一个系统的瓶颈或者不能接受的性能点，来获得系统能提供的最大服务级别的测试。
### 目的
* 评估系统的能力，测试中得到的负荷和响应时长数据可以被用于验证所计划模型的能力，并帮助做出决策。
* 识别体系中的弱点：受控的负荷可以被增加到一个极端的水平，并突破它，从而修复体系的瓶颈或薄弱的地方。
* 系统调优：重复运行测试，验证调整系统的活动得到了预期的结果，从而改进性能。
* 检测软件中的问题：长时间的测试执行可导致程序发生由于内存泄露引起的失败，揭示程序中隐含的问题或冲突。
* 验证稳定性（resilience）和可靠性（reliability）：在一个生产负荷下执行测试一定的时间是评估系统稳定性和可靠性是否满足要求的唯一方法。
### 分类
* 负载测试：确定在各种工作负载下系统的性能，目标是测试当负载逐渐增加时，系统各项性能指标的变化情况
* 压力测试：通过确定一个系统的瓶颈或者不能接受的性能点，来获得系统能提供的最大服务级别的测试
* 容量测试：确定系统可处理最大在线用户数
### 性能测试常见指标
#### 性能测试指标定义
* 事务：从客户端发起的一个或多个请求（这些请求组成一个完整的操作），到客户端接收到从服务器返回的响应
* TPS：每秒系统可以处理的事务数
* 请求响应时间：从客户端发送一个请求开始，到客户端接收到从服务器返回的响应，整个过程所消耗的时间
* 事务响应时间：主要正对用户而言，eg转账
* 并发：并发也有时间差，并发讲的是一个时间范围内，eg：一秒
    * 对同一商品秒杀
	* 对不同商品秒杀 要区分
* 并发用户数：同一单位时间内对系统发起请求的用户数量
* 吞吐量：一个性能测试过程中网络上传输的数据量的总和   
* 吞吐率：单位时间内网络传输的数据量
* 吞吐率=吞吐量/传输时间
* 点击率：每秒用户向服务器提交的请求数。
* 资源使用率：对不同系统资源的使用情况：cpu/内存/io
#### B/S架构的软件，一般关注如下服务器性能指标 
Avg Rps：平均每秒钟的响应次数 ＝ 总请求次数/秒数；   
Avg time to last byte per tertian（mstes）：平均每秒业务脚本的迭代次数；   
Successful Rounds：成功的请求；   
Failed Rounds：失败的请求；   
Hits Per Second：每秒点击次数；   
Successful Hits Per Second：每秒成功的点击次数；   
Failed Hits Per Second：每秒失败的点击数；   
Attempted Connections：尝试连接数；   
Throughput：吞吐率。吞吐率在性能测试中指单位时间内在网络上传输的数据量。是衡量网络性能的主要指标   
#### C/S架构的程序，一般软件后台通常为数据库，所以我们更注重数据库的测试指标
User Connections：用户连接数，也就是数据库的连接数量；

Number of Deadlocks：数据库死锁；

Butter Cache Hit：数据库Cache的命中情况。

在实际性能测试过程中，需要观察的性能指标并不限于以上提到的这些，需要根据实际情况做出选择和权衡，有些指标如cpu占用率／内存占用率／数据库连接池，也有非常重要的参考意义。
### 性能测试基本流程
#### 1.明确性能测试的需求
#### 2.制定性能测试方案
#### 3.编写性能测试案例
#### 4.执行性能测试案例
#### 5.分析性能测试结果
#### 6.生成性能测试报告
### web性能测试
#### 高并发网站的架构考虑前提
* 服务器横向扩展
* 数据库优化
* 尽量让一台机器可以承载更多的用户请求
#### 性能测试指标
关键点：模拟大量并发用户+监控系统负载参数分析系统瓶颈   
##### 平均响应时间
* 平均每个请求从发送到接收响应的时间
* 合理的平均响应时间（2/5/10原则）
##### 性能指标（系统资源类）
* CPU占有率
* 内存占有率
* I/O读写
* 带宽
#### 性能测试相关工具
##### top命令
使用Top获取进程资源占用信息
eg: top -ab -n 1 | grep httpd
##### sysstat
yum list sysstat
yum install sysstat版本 -y
配置文件：cat /etc/cron.d/sysstat
常用命令：
* cpu
* 内存
* IO



